set(DUNE_ARGS --root ${CMAKE_CURRENT_SOURCE_DIR} --build-dir ${CMAKE_CURRENT_BINARY_DIR}/_build)

add_custom_target(ocaml-build ALL COMMAND dune build ${DUNE_ARGS})

mal_step_test_script(ocaml-step0 step0_repl dune exe ${DUNE_ARGS} bin/step0.exe)
mal_step_test_script(ocaml-step1 step1_read_print dune exe ${DUNE_ARGS} bin/step1.exe)
mal_step_test_script(ocaml-step2 step2_eval dune exe ${DUNE_ARGS} bin/step2.exe)
mal_step_test_script(ocaml-step3 step3_env dune exe ${DUNE_ARGS} bin/step2.exe)
mal_step_test_script(ocaml-step4 step4_if_fn_do dune exe ${DUNE_ARGS} bin/step2.exe)
mal_step_test_script(ocaml-step5 step5_tco dune exe ${DUNE_ARGS} bin/step2.exe)
mal_step_test_script(ocaml-step6 step6_file dune exe ${DUNE_ARGS} bin/step2.exe)
mal_step_test_script(ocaml-step7 step7_quote dune exe ${DUNE_ARGS} bin/step2.exe)
mal_step_test_script(ocaml-step8 step8_macros dune exe ${DUNE_ARGS} bin/step2.exe)
mal_step_test_script(ocaml-step9 step9_try dune exe ${DUNE_ARGS} bin/step2.exe)
mal_step_test_script(ocaml-stepA stepA_mal dune exe ${DUNE_ARGS} bin/step2.exe)

mal_step_selfhost_test_script(ocaml-step0 step0_repl dune exe ${DUNE_ARGS} bin/step2.exe)
mal_step_selfhost_test_script(ocaml-step1 step1_read_print dune exe ${DUNE_ARGS} bin/step1.exe)
mal_step_selfhost_test_script(ocaml-step2 step2_eval dune exe ${DUNE_ARGS} bin/step2.exe)
mal_step_selfhost_test_script(ocaml-step3 step3_env dune exe ${DUNE_ARGS} bin/step2.exe)
mal_step_selfhost_test_script(ocaml-step4 step4_if_fn_do dune exe ${DUNE_ARGS} bin/step2.exe)
mal_step_selfhost_test_script(ocaml-step6 step6_file dune exe ${DUNE_ARGS} bin/step2.exe)
mal_step_selfhost_test_script(ocaml-step7 step7_quote dune exe ${DUNE_ARGS} bin/step2.exe)
mal_step_selfhost_test_script(ocaml-step8 step8_macros dune exe ${DUNE_ARGS} bin/step2.exe)
mal_step_selfhost_test_script(ocaml-step9 step9_try dune exe ${DUNE_ARGS} bin/step2.exe)
mal_step_selfhost_test_script(ocaml-stepA stepA_mal dune exe ${DUNE_ARGS} bin/step2.exe)

mal_perf(ocaml dune exe ${DUNE_ARGS} bin/step2.exe)
